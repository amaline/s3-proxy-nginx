machine:
  environment:
    NXVERSION: 1.11.4
    NXURL: http://nginx.org/download/nginx-1.11.4.tar.gz
    NXAUTHMODULEREP: https://github.com/amaline/ngx_aws_auth.git

dependencies:

   override:
    - sudo apt-get -y install curl build-essential libpcre3 libpcre3-dev zlib1g-dev libssl-dev git 
    - curl -LO ${NXURL}
    - tar zxf nginx-${NXVERSION}.tar.gz 
    - cd nginx-${NXVERSION} && git clone ${NXAUTHMODULEREP} 
    - cd nginx-${NXVERSION} && ./configure --with-http_ssl_module --add-module=ngx_aws_auth
    - cd nginx-${NXVERSION} && make 
    - mkdir nginx && mkdir nginx/conf && mkdir nginx/logs && mkdir nginx/sbin 
    - cp nginx-${NXVERSION}/objs/nginx nginx/sbin  
    - tar cvf ${CIRCLE_ARTIFACTS}/nginx-s3.tar  nginx
    

test:
  override:
     - echo test


deployment:
  hub:
    branch: master
    commands:
       - echo deploy
